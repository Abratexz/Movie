<%- include('../../partials/header', { title, user }) %>
<%- include('../../partials/message') %>

<div class="container py-4">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h3 mb-0">Manage Movies</h1>
    <a href="/admin/movies/new" class="btn btn-primary">
      <i class="bi bi-plus-lg me-1"></i> New Movie
    </a>
  </div>

  <form class="row g-2 mb-3" method="get" action="/admin/movies">
    <div class="col-sm-8 col-md-6">
      <input type="text" class="form-control" name="q" placeholder="Search title…" value="<%= q || '' %>">
    </div>
    <div class="col-auto">
      <button class="btn btn-outline-secondary">Search</button>
    </div>
  </form>

  <div class="table-responsive">
    <table class="table table-dark table-striped align-middle">
      <thead>
        <tr>
          <th style="width:72px;">Poster</th>
          <th>Title</th>
          <th class="text-nowrap">Duration</th>
          <th class="text-nowrap">Release</th>
          <th class="text-end" style="width:160px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (!rows || rows.length === 0) { %>
          <tr><td colspan="5" class="text-center  py-5">No movies found.</td></tr>
        <% } else { rows.forEach(m => { %>
          <tr>
            <td>
              <img src="/images/<%= m.poster_url %>" alt="" class="rounded" style="width:56px;height:56px;object-fit:cover"
                   onerror="this.onerror=null;this.src='/images/posters/default.png'">
            </td>
            <td class="fw-semibold"><%= m.title %></td>
            <td><%= m.duration_min ? (m.duration_min + ' min') : '-' %></td>
            <td><%= m.release_date_label || '—' %></td>
            <td class="text-end">
              <a href="/admin/movies/<%= m.id %>/edit" class="btn btn-sm btn-outline-light">Edit</a>
              <form action="/admin/movies/<%= m.id %>/delete" method="post" class="d-inline"
                    onsubmit="return confirm('Delete this movie?');">
                <button class="btn btn-sm btn-outline-danger">Delete</button>
              </form>
            </td>
          </tr>
        <% }) } %>
      </tbody>
    </table>
  </div>
</div>

<%- include('../../partials/footer') %>